; PlatformIO Project Configuration File
;
;   Build options: build flags, source filter
;   Upload options: custom upload port, speed and extra flags
;   Library options: dependencies, extra library storages
;   Advanced options: extra scripting
;
; Please visit documentation for the other options and examples
; https://docs.platformio.org/page/projectconf.html

[env]
platform = atmelavr
board = megaatmega2560
framework = arduino
build_src_filter = +<*>

[env:rotator_controller]
build_src_filter =
	${env.build_src_filter}
	-<rotator_k3ngdisplay.cpp>
lib_deps = arduino-libraries/LiquidCrystal@^1.0.7

[env:uno_r4_minima]
platform = renesas-ra
board = uno_r4_minima
framework = arduino
build_src_filter =
	${env.build_src_filter}
	-<rotator_k3ngdisplay.cpp>
build_flags =
	-O2                          ; Optimization level 2 (balanced speed/size)
	-ffunction-sections          ; Each function in its own section
	-fdata-sections              ; Each data in its own section
	-fno-exceptions              ; Disable C++ exceptions (saves space)
	-fno-threadsafe-statics      ; No thread-safe static initialization
lib_deps =
	arduino-libraries/LiquidCrystal@^1.0.7
	arduino-libraries/Ethernet@^2.0.2
lib_ignore =
	TimerOne
	TimerFive
	RTClib

; ============================================================================
; RS485 TEST ENVIRONMENTS
; ============================================================================

; Test de communication RS485 de base (Phase 1)
; Usage: pio run -e test_rs485
;        pio run -e test_rs485 --target upload
[env:test_rs485]
platform = renesas-ra
board = uno_r4_minima
framework = arduino
; Compiler uniquement le fichier de test RS485
build_src_filter =
	-<*>                            ; Exclure tout
	+<test_rs485.cpp>               ; Inclure seulement le test RS485
build_flags =
	-O2                             ; Optimization level 2
	-ffunction-sections             ; Each function in its own section
	-fdata-sections                 ; Each data in its own section
	-fno-exceptions                 ; Disable C++ exceptions
	-fno-threadsafe-statics         ; No thread-safe statics
; Pas de bibliothèques externes nécessaires pour le test de base
lib_deps =
lib_ignore =
	TimerOne
	TimerFive
	RTClib
	LiquidCrystal
	Ethernet

; Test protocole RS485 avec trames et CRC16 (Phase 2)
; Usage: pio run -e test_rs485_protocol
;        pio run -e test_rs485_protocol --target upload
[env:test_rs485_protocol]
platform = renesas-ra
board = uno_r4_minima
framework = arduino
; Compiler le test protocole + fonctions communes
build_src_filter =
	-<*>                            ; Exclure tout
	+<test_rs485_protocol.cpp>      ; Test protocole
	+<rs485_common.cpp>             ; Fonctions communes (CRC, frames)
build_flags =
	-O2                             ; Optimization level 2
	-ffunction-sections             ; Each function in its own section
	-fdata-sections                 ; Each data in its own section
	-fno-exceptions                 ; Disable C++ exceptions
	-fno-threadsafe-statics         ; No thread-safe statics
lib_deps =
lib_ignore =
	TimerOne
	TimerFive
	RTClib
	LiquidCrystal
	Ethernet

; ============================================================================
; Phase 3: Master/Remote Architecture
; ============================================================================

; Test RS485 Master (ANTENNA Unit) - Phase 3
; Usage: pio run -e test_rs485_master
;        pio run -e test_rs485_master --target upload
[env:test_rs485_master]
platform = renesas-ra
board = uno_r4_minima
framework = arduino
; Compiler le test master + classes nécessaires
build_src_filter =
	-<*>                            ; Exclure tout
	+<test_rs485_master.cpp>        ; Test master
	+<rs485_common.cpp>             ; Fonctions communes
	+<rs485_master.cpp>             ; Classe Master
build_flags =
	-O2                             ; Optimization level 2
	-ffunction-sections             ; Each function in its own section
	-fdata-sections                 ; Each data in its own section
	-fno-exceptions                 ; Disable C++ exceptions
	-fno-threadsafe-statics         ; No thread-safe statics
lib_deps =
lib_ignore =
	TimerOne
	TimerFive
	RTClib
	LiquidCrystal
	Ethernet

; Test RS485 Remote (SHACK Unit) - Phase 3
; Usage: pio run -e test_rs485_remote
;        pio run -e test_rs485_remote --target upload
[env:test_rs485_remote]
platform = renesas-ra
board = uno_r4_minima
framework = arduino
; Compiler le test remote + classes nécessaires
build_src_filter =
	-<*>                            ; Exclure tout
	+<test_rs485_remote.cpp>        ; Test remote
	+<rs485_common.cpp>             ; Fonctions communes
	+<rs485_remote.cpp>             ; Classe Remote
build_flags =
	-O2                             ; Optimization level 2
	-ffunction-sections             ; Each function in its own section
	-fdata-sections                 ; Each data in its own section
	-fno-exceptions                 ; Disable C++ exceptions
	-fno-threadsafe-statics         ; No thread-safe statics
lib_deps =
lib_ignore =
	TimerOne
	TimerFive
	RTClib
	LiquidCrystal
	Ethernet

; ============================================================================
; Phase 4: Production Environments - ANTENNA Unit (Master) & SHACK Unit (Remote)
; ============================================================================

; ANTENNA Unit (Master) - Full K3NG rotator controller at antenna site
; Usage: pio run -e antenna_unit
;        pio run -e antenna_unit --target upload
[env:antenna_unit]
platform = renesas-ra
board = uno_r4_minima
framework = arduino
; Inclure tout le code K3NG + RS485 Master (NO display on Master)
build_src_filter =
	+<*>                            ; Include everything
	-<rotator_k3ngdisplay.cpp>      ; Exclude display (on Remote)
	-<test_*.cpp>                   ; Exclude test files
	-<rs485_remote.cpp>             ; Exclude Remote code
build_flags =
	-O2                             ; Optimization level 2
	-ffunction-sections             ; Each function in its own section
	-fdata-sections                 ; Each data in its own section
	-fno-exceptions                 ; Disable C++ exceptions
	-fno-threadsafe-statics         ; No thread-safe statics
	-DUSE_ROTATOR_FEATURES_MASTER   ; Use Master features
	-DUSE_ROTATOR_PINS_MASTER       ; Use Master pins
	-DUSE_ROTATOR_SETTINGS_MASTER   ; Use Master settings (Serial1 for RS485)
lib_deps =
	arduino-libraries/Ethernet@^2.0.2
	paulstoffregen/Time@^1.6.1
lib_ignore =
	TimerOne
	TimerFive
	RTClib
	LiquidCrystal
	LiquidCrystal_I2C

; SHACK Unit (Remote) - User interface and control in shack
; Usage: pio run -e shack_unit
;        pio run -e shack_unit --target upload
[env:shack_unit]
platform = renesas-ra
board = uno_r4_minima
framework = arduino
; Inclure tout le code K3NG + RS485 Remote + I2C Display
build_src_filter =
	+<*>                            ; Include everything
	-<test_*.cpp>                   ; Exclude test files
	-<rs485_master.cpp>             ; Exclude Master code
build_flags =
	-O2                             ; Optimization level 2
	-ffunction-sections             ; Each function in its own section
	-fdata-sections                 ; Each data in its own section
	-fno-exceptions                 ; Disable C++ exceptions
	-fno-threadsafe-statics         ; No thread-safe statics
	-DUSE_ROTATOR_FEATURES_REMOTE   ; Use Remote features
	-DUSE_ROTATOR_PINS_REMOTE       ; Use Remote pins
	-DUSE_ROTATOR_SETTINGS_REMOTE   ; Use Remote settings (Serial1 for RS485)
lib_deps =
	arduino-libraries/Ethernet@^2.0.2
	paulstoffregen/Time@^1.6.1
	marcoschwartz/LiquidCrystal_I2C@^1.1.4
lib_ignore =
	TimerOne
	TimerFive
	RTClib
	LiquidCrystal
